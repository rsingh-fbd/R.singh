<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hindi VOD OTT</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { margin: 0; background: #0f1115; color: #fff; font-family: Arial, sans-serif; overflow: hidden; }
  #grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px; padding: 30px; height: 100vh; overflow-y: auto; box-sizing: border-box; }
  .card { background: #1c1f26; border-radius: 12px; overflow: hidden; cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease; }
  .card.focused { transform: scale(1.08); box-shadow: 0 0 25px #00e5ff; border: 4px solid #00e5ff; }
  .card img { width: 100%; height: 260px; object-fit: cover; }
  .card h3 { font-size: 15px; margin: 10px; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  #playerContainer { position: fixed; inset: 0; background: #000; display: none; flex-direction: column; }
  video { width: 100%; height: 100%; flex: 1; background: #000; }
  #controls { position: absolute; bottom: 0; width: 100%; padding: 20px; background: linear-gradient(transparent, rgba(0,0,0,0.9)); text-align: center; opacity: 0; transition: opacity 0.3s; pointer-events: none; }
  #controls.show { opacity: 1; pointer-events: all; }
  #controls button { padding: 12px 24px; margin: 0 10px; font-size: 18px; background: #00e5ff; color: #000; border: none; border-radius: 8px; cursor: pointer; }
  #sideList { position: absolute; right: 0; top: 0; width: 380px; height: 100%; background: rgba(0,0,0,0.95); display: none; overflow-y: auto; padding: 20px; box-sizing: border-box; border-left: 2px solid #00e5ff; }
  .side-item { padding: 16px; font-size: 18px; border-bottom: 1px solid #444; cursor: pointer; transition: background 0.2s; }
  .side-item.focused { background: #00e5ff; color: #000; font-weight: bold; }
</style>
</head>
<body>

<div id="grid"></div>

<div id="playerContainer">
  <video id="video" playsinline webkit-playsinline></video>
  <div id="controls">
    <button onclick="togglePlay()">▶ / ❚❚ Play / Pause</button>
    <button onclick="seek(-10)">◄◄ -10s</button>
    <button onclick="seek(30)">+30s ►►</button>
  </div>
  <div id="sideList"></div>
</div>

<script>
const M3U_URL = "vod.m3u";

let items = [];
let gridIndex = 0;
let sideIndex = 0;
let mode = "grid";
let columns = 1;

const grid = document.getElementById("grid");
const playerContainer = document.getElementById("playerContainer");
const video = document.getElementById("video");
const controls = document.getElementById("controls");
const sideList = document.getElementById("sideList");

/* ================= NEW THUMBNAIL GENERATOR - Supports Hindi! ================= */
function generateThumbnail(title) {
  // Clean and shorten title for better display
  let displayText = title.trim();
  if (displayText.length > 40) displayText = displayText.substring(0, 37) + "...";

  // Replace spaces with %20 and newlines with %0A for multi-line
  const encodedText = encodeURIComponent(displayText).replace(/%20/g, '+');

  // via.placeholder.com handles Hindi/Devanagari well
  // Dark blue gradient background, white text, large font
  return `https://via.placeholder.com/400x600/1a1a2e/ffffff?text=${encodedText}`;
}

/* ================= REST OF CODE (unchanged except renderGrid uses new thumbnail) ================= */
fetch(M3U_URL)
  .then(r => { if (!r.ok) throw new Error("M3U not found"); return r.text(); })
  .then(parseM3U)
  .catch(err => { grid.innerHTML = `<h2 style="text-align:center;color:red;grid-column:1/-1;">Error: ${err.message}</h2>`; });

function parseM3U(data) {
  const lines = data.trim().split("\n");
  items = [];
  for (let i = 0; i < lines.length; i++) {
    if (lines[i].trim().startsWith("#EXTINF:")) {
      const titleMatch = lines[i].match(/,(.*)$/);
      const title = titleMatch ? titleMatch[1].trim() : "Unknown Movie";
      i++;
      const url = lines[i]?.trim();
      if (url && !url.startsWith("#")) items.push({ title, url });
    }
  }
  if (items.length === 0) { grid.innerHTML = "<h2 style='text-align:center;grid-column:1/-1;'>No videos in M3U</h2>"; return; }
  calculateColumns();
  renderGrid();
  renderSideList();
  focusGridItem();
}

function renderGrid() {
  grid.innerHTML = "";
  items.forEach((item, i) => {
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <img src="\( {generateThumbnail(item.title)}" alt=" \){item.title}" loading="lazy">
      <h3>${item.title}</h3>
    `;
    card.addEventListener("click", () => playItem(i));
    grid.appendChild(card);
  });
  focusGridItem();
}

// ... (All other functions remain exactly the same: renderSideList, focus helpers, playItem, controls, key navigation, etc.)

function renderSideList() {
  sideList.innerHTML = "";
  items.forEach((item, i) => {
    const div = document.createElement("div");
    div.className = "side-item";
    div.textContent = item.title;
    div.addEventListener("click", () => { sideIndex = i; playItem(i); });
    sideList.appendChild(div);
  });
  focusSideItem();
}

function calculateColumns() {
  columns = Math.max(1, Math.floor((window.innerWidth - 60) / 200));
}

function focusGridItem() {
  const cards = grid.querySelectorAll(".card");
  cards.forEach((c, i) => c.classList.toggle("focused", i === gridIndex));
  cards[gridIndex]?.scrollIntoView({ block: "center", inline: "center", behavior: "smooth" });
}

function focusSideItem() {
  const sides = sideList.querySelectorAll(".side-item");
  sides.forEach((s, i) => s.classList.toggle("focused", i === sideIndex));
  sides[sideIndex]?.scrollIntoView({ block: "nearest", behavior: "smooth" });
}

function playItem(index) {
  if (index < 0 || index >= items.length) return;
  video.src = items[index].url;
  video.play().catch(() => {});
  playerContainer.style.display = "flex";
  grid.style.display = "none";
  sideIndex = index;
  renderSideList();
  mode = "player";
  hideControlsTimeout();
}

function exitPlayer() {
  video.pause(); video.src = "";
  playerContainer.style.display = "none";
  grid.style.display = "grid";
  controls.classList.remove("show");
  sideList.style.display = "none";
  mode = "grid";
  focusGridItem();
}

let controlsTimeout;
function showControls() { controls.classList.add("show"); clearTimeout(controlsTimeout); controlsTimeout = setTimeout(() => controls.classList.remove("show"), 5000); }
function hideControlsTimeout() { clearTimeout(controlsTimeout); controlsTimeout = setTimeout(() => controls.classList.remove("show"), 5000); }
function togglePlay() { video.paused ? video.play() : video.pause(); showControls(); }
function seek(sec) { video.currentTime = Math.max(0, video.currentTime + sec); showControls(); }

document.addEventListener("keydown", e => {
  if (["Backspace", "Escape"].includes(e.key) || e.keyCode === 461) {
    if (mode !== "grid") { e.preventDefault(); exitPlayer(); }
    return;
  }
  // Grid navigation, player controls, etc. (same as before)
  if (mode === "grid") {
    let moved = true;
    if (e.key === "ArrowRight") gridIndex = Math.min(items.length - 1, gridIndex + 1);
    else if (e.key === "ArrowLeft") gridIndex = Math.max(0, gridIndex - 1);
    else if (e.key === "ArrowDown") gridIndex = Math.min(items.length - 1, gridIndex + columns);
    else if (e.key === "ArrowUp") gridIndex = Math.max(0, gridIndex - columns);
    else if (["Enter", " "].includes(e.key)) { playItem(gridIndex); return; }
    else moved = false;
    if (moved) { e.preventDefault(); focusGridItem(); }
  } else {
    showControls();
    // Down/Up navigation for controls and list (same logic as before)
    if (e.key === "ArrowDown") { /* ... same as previous */ }
  }
});

document.addEventListener("mousemove", () => { if (mode !== "grid") showControls(); });
</script>

</body>
</html>