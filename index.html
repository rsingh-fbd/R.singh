<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Perfect TV Pro</title>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
:root{
  --bg:#000;
  --accent:#00ff9d;
  --text:#fff;
  --muted:#ccc;
}

*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%;background:#000;font-family:Arial;color:white;overflow:hidden}
video{position:fixed;top:0;left:0;width:100%;height:100%;object-fit:contain;background:#000;z-index:1}

/* Now Playing */
.now-playing{
  position:fixed;top:10px;left:50%;transform:translateX(-50%);
  background:rgba(0,0,0,0.75);padding:14px 40px;border-radius:50px;
  font-size:22px;font-weight:600;z-index:20;opacity:0;transition:.4s;
}
.now-playing.show{opacity:1}

/* Menu buttons */
.menu-btn,.favorite-btn,.quality-btn{
  position:fixed;top:10px;padding:12px 20px;border-radius:50px;
  background:rgba(0,0,0,0.7);border:2px solid var(--accent);
  font-size:18px;z-index:20;opacity:0;transition:.4s;cursor:pointer
}
.menu-btn{left:20px}
.favorite-btn{left:140px}
.quality-btn{right:20px}
.menu-btn.show,.favorite-btn.show,.quality-btn.show{opacity:1}

/* Sidebar */
.sidebar{
  position:fixed;top:0;left:-380px;width:340px;height:100%;
  background:rgba(10,10,20,0.97);backdrop-filter:blur(10px);
  z-index:30;padding:16px;transition:left .35s ease;
  display:flex;flex-direction:column;gap:12px
}
.sidebar.visible{left:0}

.search{
  padding:14px;border-radius:14px;font-size:18px;
  background:rgba(255,255,255,0.15);color:#fff;border:none;outline:none;
}
.tabs{display:flex;gap:6px}
.tab{
  flex:1;padding:10px;border-radius:10px;text-align:center;
  background:#222;color:white;cursor:pointer;font-weight:600;
}
.tab.active{background:var(--accent);color:#000}

.channel-list{flex:1;overflow-y:auto}
.channel{
  padding:14px 18px;border-radius:12px;margin:5px 0;
  background:#111;display:flex;justify-content:space-between;
  cursor:pointer;transition:.2s;
}
.channel:focus{background:var(--accent);color:#000;outline:none}
.channel.active{background:var(--accent);color:#000}
.star{font-size:20px}

.controls{
  position:fixed;bottom:15px;left:50%;transform:translateX(-50%);
  background:rgba(0,0,0,0.75);padding:12px 30px;border-radius:50px;
  display:flex;gap:18px;opacity:0;transition:.4s;z-index:20;
}
.controls.show{opacity:1}
.btn{padding:12px 22px;background:#222;border-radius:30px;color:white;font-size:18px}

/* Quality Menu */
.quality-menu{
  position:fixed;bottom:70px;right:20px;width:180px;
  background:rgba(10,10,30,0.97);border:2px solid var(--accent);
  border-radius:12px;z-index:40;padding:10px 0;
  opacity:0;transform:scale(.9);pointer-events:none;transition:.25s;
}
.quality-menu.show{opacity:1;transform:scale(1);pointer-events:auto}
.q-item{
  padding:12px 20px;font-size:18px;cursor:pointer;
}
.q-item:focus{background:var(--accent);color:#000;outline:none}
.q-item.active{background:var(--accent);color:#000;font-weight:bold}
</style>
</head>

<body>
<video id="video" playsinline></video>

<div id="nowPlaying" class="now-playing">Loading...</div>

<button id="menuBtn" class="menu-btn">Menu</button>
<button id="favBtn" class="favorite-btn">★ Fav</button>
<button id="qualityBtn" class="quality-btn">Quality</button>

<div id="controls" class="controls">
  <button class="btn" id="prev">Prev</button>
  <button class="btn" id="play">Play</button>
  <button class="btn" id="next">Next</button>
</div>

<!-- Sidebar -->
<aside id="sidebar" class="sidebar">
  <div class="tabs">
    <div class="tab active" id="tabAll">All</div>
    <div class="tab" id="tabFav">Favorites</div>
  </div>

  <input type="text" id="search" class="search" placeholder="Search...">

  <div id="list" class="channel-list"></div>
</aside>

<!-- Quality Menu -->
<div id="qualityMenu" class="quality-menu"></div>
<script>
const video=document.getElementById("video");
const nowPlaying=document.getElementById("nowPlaying");
const menuBtn=document.getElementById("menuBtn");
const favBtn=document.getElementById("favBtn");
const qualityBtn=document.getElementById("qualityBtn");
const qualityMenu=document.getElementById("qualityMenu");
const controls=document.getElementById("controls");
const sidebar=document.getElementById("sidebar");
const list=document.getElementById("list");
const search=document.getElementById("search");

let channels=[],filtered=[],favorites=[];
let current=-1,isSidebarOpen=false,isQualityOpen=false;
let hls=null,hideTimer=null;

// Load favorites
favorites = JSON.parse(localStorage.getItem("favorites") || "[]");

// Load playlist
fetch("https://raw.githubusercontent.com/rsingh-fbd/R.singh/main/Playlist.m3u?t="+Date.now())
.then(r=>r.text()).then(txt=>{
  let lines=txt.split(/\r?\n/);
  for(let i=0;i<lines.length;i++){
    if(lines[i].startsWith("#EXTINF")){
      let title=lines[i].split(",")[1].trim();
      let url=lines[i+1];
      if(url && !url.startsWith("#")) channels.push({title,url});
    }
  }
  filtered=[...channels];
  renderList();
  let last = localStorage.getItem("lastChannel");
  let idx = channels.findIndex(c=>c.title===last);
  playChannel(idx>=0?idx:0);
});

// Render list
function renderList(){
  list.innerHTML="";
  filtered.forEach((ch,i)=>{
    let div=document.createElement("div");
    div.className="channel";
    div.tabIndex=0;
    div.innerHTML=`<span>${ch.title}</span><span class='star'>${favorites.includes(ch.title)?"★":"☆"}</span>`;
    div.onclick=()=>{ playChannel(i); hideSidebar(); };
    div.onkeydown=e=>{ if(e.key==="Enter"){ playChannel(i); hideSidebar(); } };
    list.appendChild(div);
  });
}

// Play channel
function playChannel(idx){
  if(idx<0||idx>=filtered.length) return;
  current=idx;
  let ch=filtered[idx];
  nowPlaying.textContent=ch.title;
  localStorage.setItem("lastChannel",ch.title);

  if(hls){hls.destroy();hls=null;}
  if(Hls.isSupported() && ch.url.includes(".m3u8")){
    hls=new Hls();
    hls.loadSource(ch.url); hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED,()=>video.play());
  } else { video.src=ch.url; video.play(); }

  showUI();
}

// UI auto hide
function showUI(){
  menuBtn.classList.add("show");
  favBtn.classList.add("show");
  qualityBtn.classList.add("show");
  controls.classList.add("show");
  nowPlaying.classList.add("show");
  clearTimeout(hideTimer);
  hideTimer=setTimeout(()=>{
    if(!isSidebarOpen&&!isQualityOpen){
      menuBtn.classList.remove("show");
      favBtn.classList.remove("show");
      qualityBtn.classList.remove("show");
      controls.classList.remove("show");
      nowPlaying.classList.remove("show");
    }
  },4000);
}

// Sidebar
function showSidebar(){ sidebar.classList.add("visible"); isSidebarOpen=true; }
function hideSidebar(){ sidebar.classList.remove("visible"); isSidebarOpen=false; showUI(); }

// Search
search.oninput=()=>{
  let q=search.value.toLowerCase();
  filtered=channels.filter(c=>c.title.toLowerCase().includes(q));
  renderList();
};

// Favorites Toggle
favBtn.onclick=()=>{
  let title = filtered[current].title;
  if(favorites.includes(title))
    favorites=favorites.filter(x=>x!==title);
  else favorites.push(title);

  localStorage.setItem("favorites",JSON.stringify(favorites));
  renderList();
};

// Tabs
document.getElementById("tabAll").onclick=()=>{
  filtered=[...channels];
  document.getElementById("tabAll").classList.add("active");
  document.getElementById("tabFav").classList.remove("active");
  renderList();
};

document.getElementById("tabFav").onclick=()=>{
  filtered=channels.filter(c=>favorites.includes(c.title));
  document.getElementById("tabFav").classList.add("active");
  document.getElementById("tabAll").classList.remove("active");
  renderList();
};

// Buttons
menuBtn.onclick=()=>isSidebarOpen?hideSidebar():showSidebar();
document.getElementById("next").onclick=()=>playChannel((current+1)%filtered.length);
document.getElementById("prev").onclick=()=>playChannel((current-1+filtered.length)%filtered.length);
document.getElementById("play").onclick=()=>video.paused?video.play():video.pause();

// DPAD Navigation
document.addEventListener("keydown",e=>{
  showUI();
  if(e.key==="ArrowRight"){ playChannel((current+1)%filtered.length); }
  if(e.key==="ArrowLeft"){ playChannel((current-1+filtered.length)%filtered.length); }

  if(e.key==="Backspace"){
    if(isSidebarOpen){ hideSidebar(); return; }
    if(isQualityOpen){ hideQualityMenu(); return; }
    window.Android?.exitApp();
  }
});
</script>

</body>
</html>