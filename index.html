<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart TV Live Player</title>
  <style>
    body { margin:0; background:#000; color:#fff; font-family:Arial, sans-serif; overflow:hidden; }
    #player { width:100%; height:100vh; background:#000; }
    video { width:100%; height:100%; background:#000; }

    /* Overlay channel list */
    #channelOverlay {
      position:fixed; top:0; left:0; bottom:0;
      width:280px; background:rgba(20,20,20,0.95);
      overflow-y:auto; transform:translateX(-100%);
      transition:transform 0.3s ease; z-index:1000;
    }
    #channelOverlay.show { transform:translateX(0); }
    #channelOverlay ul { list-style:none; margin:0; padding:0; }
    #channelOverlay li {
      padding:12px; display:flex; align-items:center;
      border-bottom:1px solid #333; cursor:pointer;
    }
    #channelOverlay li img { width:36px; height:36px; margin-right:10px; object-fit:contain; }
    #channelOverlay li span { flex:1; }
    #channelOverlay li.active, #channelOverlay li.highlight {
      background:#0066ff; color:#fff;
    }

    /* Now Playing toast */
    #toast {
      position:fixed; bottom:20px; left:20px;
      background:rgba(0,0,0,0.8); padding:10px 16px;
      border-radius:6px; display:flex; align-items:center;
      opacity:0; transition:opacity 0.5s;
      z-index:1100;
    }
    #toast.show { opacity:1; }
    #toast img { width:28px; height:28px; margin-right:8px; }

    /* Controls */
    #controls {
      position:absolute; bottom:30px; left:50%;
      transform:translateX(-50%); display:flex; align-items:center;
      opacity:0; transition:opacity 0.3s; z-index:900;
    }
    #controls.show { opacity:1; }
    #controls button {
      background:rgba(0,0,0,0.6); border:none; color:#fff;
      padding:10px 14px; margin:0 6px; border-radius:6px;
      cursor:pointer; font-size:14px;
    }
    #volume {
      -webkit-appearance:none; width:100px; height:6px;
      border-radius:4px; background:#444; margin-left:10px;
    }
    #volume::-webkit-slider-thumb {
      -webkit-appearance:none; width:14px; height:14px; border-radius:50%;
      background:#fff; cursor:pointer;
    }
  </style>
</head>
<body>
  <div id="player">
    <video id="video" controls autoplay></video>
    <div id="controls">
      <button id="prevBtn">⏮ Prev</button>
      <button id="nextBtn">Next ⏭</button>
      <input type="range" id="volume" min="0" max="1" step="0.05" value="1">
    </div>
  </div>

  <!-- Channel List Overlay -->
  <div id="channelOverlay">
    <ul id="channelList"></ul>
  </div>

  <!-- Now Playing Toast -->
  <div id="toast"><img id="toastLogo"><span id="toastText"></span></div>

  <script>
    const m3uUrl = "https://raw.githubusercontent.com/rsingh-fbd/R.singh/main/Playlist.m3u";
    const video = document.getElementById("video");
    const channelOverlay = document.getElementById("channelOverlay");
    const channelListEl = document.getElementById("channelList");
    const toast = document.getElementById("toast");
    const toastText = document.getElementById("toastText");
    const toastLogo = document.getElementById("toastLogo");
    const controls = document.getElementById("controls");
    const volumeSlider = document.getElementById("volume");
    let channels = [];
    let currentIndex = 0;
    let highlightIndex = 0;
    let overlayOpen = false;
    let hideControlsTimeout;

    async function loadM3U() {
      const res = await fetch(m3uUrl);
      const text = await res.text();
      parseM3U(text);
    }

    function parseM3U(data) {
      const lines = data.split("\n");
      let current = {};
      channels = [];
      lines.forEach(line => {
        line = line.trim();
        if (line.startsWith("#EXTINF")) {
          const nameMatch = line.match(/,(.*)$/);
          const logoMatch = line.match(/tvg-logo="([^"]*)"/);
          current = {
            name: nameMatch ? nameMatch[1] : "Unnamed",
            logo: logoMatch ? logoMatch[1] : null
          };
        } else if (line && !line.startsWith("#")) {
          current.url = line;
          channels.push(current);
          current = {};
        }
      });
      renderChannelList();
      playChannel(0);
    }

    function renderChannelList() {
      channelListEl.innerHTML = "";
      channels.forEach((ch, idx) => {
        const li = document.createElement("li");
        if (ch.logo) {
          const img = document.createElement("img");
          img.src = ch.logo;
          li.appendChild(img);
        }
        const span = document.createElement("span");
        span.textContent = ch.name;
        li.appendChild(span);
        li.addEventListener("click", () => {
          playChannel(idx);
          closeOverlay();
        });
        channelListEl.appendChild(li);
      });
      updateHighlight();
    }

    function playChannel(index) {
      if (index < 0) index = channels.length - 1;
      if (index >= channels.length) index = 0;
      currentIndex = index;
      const ch = channels[index];
      video.src = ch.url;
      showToast(ch);
      updateActiveChannel();
    }

    function updateActiveChannel() {
      [...channelListEl.children].forEach((li,i) => {
        li.classList.toggle("active", i===currentIndex);
      });
    }

    function showToast(ch) {
      toastText.textContent = ch.name;
      if (ch.logo) { toastLogo.src = ch.logo; toastLogo.style.display="block"; }
      else { toastLogo.style.display="none"; }
      toast.classList.add("show");
      setTimeout(()=> toast.classList.remove("show"), 3000);
    }

    // Overlay
    function openOverlay() {
      overlayOpen = true;
      channelOverlay.classList.add("show");
      highlightIndex = currentIndex;
      updateHighlight();
    }
    function closeOverlay() {
      overlayOpen = false;
      channelOverlay.classList.remove("show");
    }
    function toggleOverlay() {
      overlayOpen ? closeOverlay() : openOverlay();
    }

    function updateHighlight() {
      [...channelListEl.children].forEach((li,i) => {
        li.classList.toggle("highlight", i===highlightIndex);
      });
    }

    // Controls auto-hide
    function showControls() {
      controls.classList.add("show");
      clearTimeout(hideControlsTimeout);
      hideControlsTimeout = setTimeout(() => controls.classList.remove("show"), 3000);
    }
    document.addEventListener("mousemove", showControls);
    document.addEventListener("keydown", showControls);

    // Volume
    volumeSlider.addEventListener("input", () => {
      video.volume = volumeSlider.value;
    });

    // Next/Prev
    document.getElementById("nextBtn").onclick = () => playChannel(currentIndex+1);
    document.getElementById("prevBtn").onclick = () => playChannel(currentIndex-1);

    // Key / Remote events
    document.addEventListener("keydown", (e) => {
      switch(e.key) {
        case "ArrowUp":
          if (overlayOpen) {
            highlightIndex = (highlightIndex-1+channels.length)%channels.length;
            updateHighlight();
          } else {
            playChannel(currentIndex-1);
          }
          break;
        case "ArrowDown":
          if (overlayOpen) {
            highlightIndex = (highlightIndex+1)%channels.length;
            updateHighlight();
          } else {
            playChannel(currentIndex+1);
          }
          break;
        case "Enter":
        case "OK": // some TVs send "OK"
          if (overlayOpen) {
            playChannel(highlightIndex);
            closeOverlay();
          } else {
            openOverlay();
          }
          break;
        case "Escape":
        case "Backspace":
          closeOverlay();
          break;
        case "ArrowLeft":
          video.volume = Math.max(0, video.volume-0.05);
          volumeSlider.value = video.volume;
          break;
        case "ArrowRight":
          video.volume = Math.min(1, video.volume+0.05);
          volumeSlider.value = video.volume;
          break;
        case "f": case "F":
          if (document.fullscreenElement) document.exitFullscreen();
          else video.requestFullscreen();
          break;
        case "m": case "M":
          video.muted = !video.muted;
          break;
      }
    });

    loadM3U();
  </script>
</body>
</html>