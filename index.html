<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Smart TV IPTV Player</title>
  <style>
    body {margin:0;background:#000;color:#fff;font-family:sans-serif;overflow:hidden}
    #player {width:100%;height:100vh;background:#000;object-fit:contain}
    #overlayList {
      position:fixed;top:0;left:0;width:300px;height:100%;
      background:rgba(20,20,20,0.95);overflow-y:auto;
      transform:translateX(-100%);transition:0.3s;z-index:1000;padding:10px;
    }
    #overlayList.show {transform:translateX(0)}
    .channel {padding:8px;cursor:pointer;display:flex;align-items:center;gap:8px}
    .channel:hover,.channel.active {background:#333}
    .channel img {width:30px;height:30px;object-fit:contain}
    #controls {
      position:absolute;bottom:20px;left:50%;transform:translateX(-50%);
      display:flex;gap:20px;opacity:0;transition:0.3s;z-index:900;
      align-items:center;
    }
    #controls.show {opacity:1}
    .btn {
      background:rgba(0,0,0,0.6);padding:10px 15px;border-radius:8px;cursor:pointer;
      user-select:none;
    }
    #toast {
      position:absolute;bottom:60px;left:20px;background:rgba(0,0,0,0.7);
      padding:10px 15px;border-radius:8px;display:none;align-items:center;gap:10px;
      animation:fadein 0.5s;
    }
    #toast img {width:40px;height:40px;object-fit:contain}
    @keyframes fadein {from{opacity:0}to{opacity:1}}
    #volSlider {
      width:0;overflow:hidden;transition:width 0.3s;background:#222;
      border-radius:8px;padding:5px;
    }
    #volSlider input {width:100px}
  </style>
</head>
<body>

<video id="player" controls autoplay></video>

<div id="overlayList"></div>

<div id="controls">
  <div class="btn" id="prevBtn">‚èÆ Prev</div>
  <div class="btn" id="nextBtn">Next ‚è≠</div>
  <div class="btn" id="volBtn">üîä</div>
  <div id="volSlider"><input type="range" min="0" max="1" step="0.05" id="volume"></div>
</div>

<div id="toast"><img id="toastLogo"><span id="toastText"></span></div>

<script>
const player=document.getElementById('player');
const overlay=document.getElementById('overlayList');
const toast=document.getElementById('toast');
const toastLogo=document.getElementById('toastLogo');
const toastText=document.getElementById('toastText');
const volume=document.getElementById('volume');
const volSlider=document.getElementById('volSlider');
const volBtn=document.getElementById('volBtn');
let channels=[],currentIndex=0,hideTimeout;

// Parse M3U file
async function loadM3U(){
  let res=await fetch("https://raw.githubusercontent.com/rsingh-fbd/R.singh/main/Playlist.m3u");
  let text=await res.text();
  let lines=text.split("\n");let tempName="",tempLogo="";
  lines.forEach(line=>{
    if(line.startsWith("#EXTINF")){
      let name=line.match(/,(.*)$/)?.[1]?.trim()||"Channel";
      let logo=line.match(/tvg-logo="(.*?)"/)?.[1]||"";
      tempName=name;tempLogo=logo;
    } else if(line.trim() && !line.startsWith("#")){
      channels.push({name:tempName,url:line.trim(),logo:tempLogo});
    }
  });
  renderChannels();playChannel(0);
}

// Render channel list
function renderChannels(){
  overlay.innerHTML=channels.map((c,i)=>`
    <div class="channel" data-idx="${i}">
      ${c.logo?`<img src="${c.logo}">`:""} <span>${c.name}</span>
    </div>`).join("");
  overlay.querySelectorAll(".channel").forEach(ch=>{
    ch.onclick=()=>{
      playChannel(parseInt(ch.dataset.idx));
      toggleOverlay(false);
    }
  });
}

// Play channel
function playChannel(i){
  if(i<0||i>=channels.length)return;
  currentIndex=i;
  let ch=channels[i];
  player.src=ch.url;player.play();
  showToast(ch);
  overlay.querySelectorAll(".channel").forEach(el=>el.classList.remove("active"));
  let active=overlay.querySelector(`.channel[data-idx="${i}"]`);
  if(active)active.classList.add("active");
}

// Toast display
function showToast(ch){
  toast.style.display="flex";
  toastText.textContent=ch.name;
  toastLogo.style.display=ch.logo?"block":"none";
  if(ch.logo)toastLogo.src=ch.logo;
  setTimeout(()=>toast.style.display="none",3000);
}

// Controls auto-hide
function showControls(){
  document.getElementById("controls").classList.add("show");
  clearTimeout(hideTimeout);
  hideTimeout=setTimeout(()=>document.getElementById("controls").classList.remove("show"),3000);
}
document.body.addEventListener("mousemove",showControls);
document.body.addEventListener("click",showControls);

// Overlay toggle
function toggleOverlay(force){
  if(force===false)overlay.classList.remove("show");
  else overlay.classList.toggle("show");
}

// Buttons
document.getElementById("nextBtn").onclick=()=>playChannel((currentIndex+1)%channels.length);
document.getElementById("prevBtn").onclick=()=>playChannel((currentIndex-1+channels.length)%channels.length);
volBtn.onclick=()=>volSlider.style.width=volSlider.style.width?"0":"120px";
volume.oninput=()=>player.volume=volume.value;

// Remote key handling
document.addEventListener("keydown",e=>{
  switch(e.key){
    case "ArrowUp":playChannel((currentIndex-1+channels.length)%channels.length);break;
    case "ArrowDown":playChannel((currentIndex+1)%channels.length);break;
    case "ArrowLeft":player.volume=Math.max(0,player.volume-0.1);volume.value=player.volume;break;
    case "ArrowRight":player.volume=Math.min(1,player.volume+0.1);volume.value=player.volume;break;
    case "Enter":toggleOverlay();break;
    case "Backspace":case "Escape":toggleOverlay(false);break;
  }
  showControls();
});

loadM3U();
</script>
</body>
</html>