<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>YouTube Player</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    background: black;
    overflow: hidden;
}

#player-wrapper {
    position: fixed;
    inset: 0;
    background: black;
    overflow: hidden;
}

#player-wrapper iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 0;
}

/* Improved landscape/portrait handling */
@media (orientation: landscape) {
    #player-wrapper iframe {
        width: 100vw;
        height: 100vh;
    }
}

@media (orientation: portrait) {
    #player-wrapper iframe {
        width: 100vw;
        height: 56.25vw; /* 9/16 aspect ratio */
        top: 50%;
        transform: translateY(-50%);
    }
}
</style>
</head>

<body>

<div id="player-wrapper"></div>

<script>
const DEFAULT_CONFIG = {
    url: "",
    autoplay: 1,
    mute: 1,
    controls: 1,
    loop: 0,
    rel: 0,
    start: 0
};

const JSON_FILE = "files/video.json";
const DEFAULT_VIDEO_ID = "dQw4w9WgXcQ"; // Rick Roll as fallback

function getYouTubeId(url) {
    if (!url || url.trim() === "") return DEFAULT_VIDEO_ID;
    
    // Handle various YouTube URL formats
    let videoId = "";
    
    // youtube.com/watch?v=VIDEO_ID
    if (url.includes("youtube.com/watch")) {
        const urlObj = new URL(url);
        videoId = urlObj.searchParams.get("v");
    }
    // youtu.be/VIDEO_ID
    else if (url.includes("youtu.be/")) {
        videoId = url.split("youtu.be/")[1].split(/[?&#]/)[0];
    }
    // Direct video ID
    else if (/^[a-zA-Z0-9_-]{11}$/.test(url)) {
        videoId = url;
    }
    
    return videoId || DEFAULT_VIDEO_ID;
}

function buildEmbedUrl(videoId, cfg) {
    const params = new URLSearchParams({
        autoplay: cfg.autoplay || 1,
        mute: cfg.mute || 1,
        controls: cfg.controls || 1,
        rel: cfg.rel || 0,
        start: cfg.start || 0,
        playsinline: 1,
        enablejsapi: 1,
        modestbranding: 1,
        fs: 1 // Enable fullscreen
    });

    // YouTube no longer supports loop parameter directly
    // Loop functionality must be handled via YouTube Player API
    if (cfg.loop === 1) {
        // We'll handle looping through JavaScript API
        console.log("Loop requested - will implement via YouTube Player API");
    }

    return `https://www.youtube.com/embed/${videoId}?${params.toString()}`;
}

function loadVideo(config) {
    const videoId = getYouTubeId(config.url);
    const embedUrl = buildEmbedUrl(videoId, config);
    
    const iframe = document.createElement('iframe');
    iframe.src = embedUrl;
    iframe.width = '100%';
    iframe.height = '100%';
    iframe.frameBorder = '0';
    iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen';
    iframe.allowFullscreen = true;
    iframe.title = 'YouTube video player';
    
    const wrapper = document.getElementById('player-wrapper');
    wrapper.innerHTML = '';
    wrapper.appendChild(iframe);
    
    // If loop is enabled, we need to use YouTube Player API
    if (config.loop === 1) {
        // This would require loading YouTube IFrame API
        console.log("Note: For looping, implement YouTube IFrame API");
    }
}

// Load configuration and start player
fetch(JSON_FILE)
    .then(response => {
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
        }
        return response.json();
    })
    .then(config => {
        // Merge with defaults
        const finalConfig = { ...DEFAULT_CONFIG, ...config };
        loadVideo(finalConfig);
    })
    .catch(error => {
        console.error('Failed to load video config:', error);
        
        // Show error message
        const wrapper = document.getElementById('player-wrapper');
        wrapper.innerHTML = `
            <div style="color: white; text-align: center; padding: 20px; font-family: Arial;">
                <h2>Failed to load video configuration</h2>
                <p>Error: ${error.message}</p>
                <p>Trying default video...</p>
            </div>
        `;
        
        // Try loading default video after delay
        setTimeout(() => {
            loadVideo({ url: DEFAULT_VIDEO_ID, ...DEFAULT_CONFIG });
        }, 3000);
    });

// Handle resize events for better responsiveness
window.addEventListener('resize', function() {
    const iframe = document.querySelector('#player-wrapper iframe');
    if (iframe) {
        // Force iframe to re-evaluate its size
        iframe.style.width = '100%';
        iframe.style.height = '100%';
    }
});

// Handle fullscreen changes
document.addEventListener('fullscreenchange', updatePlayerSize);
document.addEventListener('webkitfullscreenchange', updatePlayerSize);

function updatePlayerSize() {
    const iframe = document.querySelector('#player-wrapper iframe');
    if (iframe && document.fullscreenElement) {
        iframe.style.width = '100vw';
        iframe.style.height = '100vh';
    }
}
</script>

</body>
</html>